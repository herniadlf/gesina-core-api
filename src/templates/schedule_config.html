{% extends "layout.html" %}
{% block content %}
    <div>
        <div class="d-flex justify-content-between">
            <h2>Configuración de simulaciones recurrentes</h2>
        </div>
        <div class="d-flex justify-content-between pt-4">
            <h4>General</h4>
        </div>
        <div class="container-xxl">
            {% if id %}
                <form method=post
                      enctype=multipart/form-data
                      class="p-4 container needs-validation"
                      id="schedule-config-form"
                      action="{{ url_for('view_controller.save_or_create_schedule_config', schedule_config_id=id) }}">
            {% else %}
                <form method=post
                  enctype=multipart/form-data
                  class="p-4 container needs-validation"
                  id="schedule-config-form"
                  action="{{ url_for('view_controller.save_or_create_schedule_config', schedule_config_id='') }}">
            {% endif %}
                    {{ form.csrf_token }}
                    <div class="form-group">
                        {{ form.name.label }}: {{ form.name(class_="form-control") }}
                    </div>
                    <div class="form-group">
                        {{ form.description.label }}: {{ form.description(class_="form-control") }}
                    </div>
                    <div class="form-group">
                        {{ form.geometry_id.label }}: {{ form.geometry_id(class_="form-control") }}
                    </div>
                    <div class="form-group">
                        {{ form.start_datetime.label }}: {{ form.start_datetime(class_="form-control") }}
                    </div>
                    <div class="form-group">
                        {{ form.frequency.label }}: {{ form.frequency(class_="form-control") }}
                    </div>
                    <div class="form-group">
                        <div class="custom-control custom-switch">
                             {{ form.enabled(class_="custom-control-input") }} {{ form.enabled.label(class_="custom-control-label") }}
                        </div>
                    </div>

                    <div class="d-flex justify-content-between pt-4">
                        <h4>Configuración de borde</h4>
                    </div>

                    <div class="form-group">
                        {{ form.observation_days.label }}: {{ form.observation_days(class_="form-control") }}
                    </div>

                    <div class="form-group">
                        {{ form.forecast_days.label }}: {{ form.forecast_days(class_="form-control") }}
                    </div>

                    <div class="form-group" id="start_condition_type_container">
                        {{ form.start_condition_type.label }}: {{ form.start_condition_type(class_="form-control") }}
                    </div>

                    <div class="form-group" id="restart_file_container">
                        {{ form.restart_file.label }}: {{ form.restart_file(class_="form-control") }}
                    </div>

                    <div class="form-group" id="initial_flow_list_container">
                        {{ form.initial_flow_list.label }}
                        <table class="table" id="initial_flow_table">
                          <thead>
                            <tr>
                              <th scope="col">#</th>
                              <th scope="col">River</th>
                              <th scope="col">Reach</th>
                              <th scope="col">River stat</th>
                              <th scope="col">Flow</th>
                            </tr>
                          </thead>
                          <tbody id="initial_flow_table_body">
                            {% for form in form.initial_flow_list %}
                                <tr>
                                    <th scope="row">{{loop.index}}</th>
                                    <td>{{ form.river }}</td>
                                    <td>{{ form.reach }}</td>
                                    <td>{{ form.river_stat }}</td>
                                    <td>{{ form.flow }}</td>
                                </tr>
                            {% endfor %}
                          </tbody>
                        </table>
                        <button id="add-row" type="button" class="btn btn-success fa-solid fa-plus"></button>
                        <button id="remove-row" type="button" class="btn btn-danger fa-solid fa-minus"></button>
                    </div>

                    <div class="d-flex justify-content-between pt-4">
                        <h4>Configuración de plan</h4>
                    </div>

                    <div class="form-group pt-4">
                        <button type="submit" class="btn btn-primary">Guardar</button>
                    </div>
                </form>
        </div>
    </div>

    <script>
        $( document ).ready(function() {
            $( "#add-row" ).on("click", function() {
                idx = $("#initial_flow_table_body")[0].rows.length + 1

                new_row = `
                    <tr>
                        <th scope="row">${idx}</th>
                        <td><input id="initial_flow_list-${idx}-river" name="initial_flow_list-${idx}-river" required="" type="text" value=""></td>
                        <td><input id="initial_flow_list-${idx}-reach" name="initial_flow_list-${idx}-reach" required="" type="text" value=""></td>
                        <td><input id="initial_flow_list-${idx}-river_stat" name="initial_flow_list-${idx}-river_stat" required="" step="any" type="number" value=""></td>
                        <td><input id="initial_flow_list-${idx}-flow" name="initial_flow_list-${idx}-flow" required="" step="any" type="number" value=""></td>
                    </tr>
                `
                $( "#initial_flow_table_body" ).append( new_row );
            });

            $( "#remove-row" ).on("click", function() {
                $('#initial_flow_table_body tr:last-child').remove();
            });

            function hide_show_initial_condition_conf() {
                if( $("#start_condition_type")[0].value === "restart_file" ) {
                    $("#restart_file_container").show()
                    $("#initial_flow_list_container").hide()
                } else {
                    $("#restart_file_container").hide()
                    $("#initial_flow_list_container").show()
                }
            }

            hide_show_initial_condition_conf()

            $( "#start_condition_type" ).on("change", hide_show_initial_condition_conf);
        });
    </script>
{% endblock %}